import{k as N,h as S,r as h,l as k,j as s}from"./react-igPjiDWs.js";import{u as C,L as D}from"./index-CJ5WocF5.js";import{u as E,a as y,s as b,E as L,q as r}from"./schemas-BZNeO2np.js";import"./charts-CF39Kqye.js";const j={async get(){return(await y.get("/api/settings",b)).data},async update(a){const d=E.parse(a);return(await y.patch("/api/settings",b,d)).data}},K=()=>{const a=N(),{theme:d,density:u,setDensity:m,setTheme:g}=C(),o=S({queryKey:r.settings,queryFn:j.get}),[i,l]=h.useState(null),[v,p]=h.useState("");h.useEffect(()=>{o.data&&l(e=>e||{...o.data,theme:d,density:u})},[u,o.data,d]);const x=k({mutationFn:j.update,onMutate:async e=>{p("Saving..."),await a.cancelQueries({queryKey:r.settings});const t=a.getQueryData(r.settings);return t&&a.setQueryData(r.settings,{...t,...e,notifications:{...t.notifications,...e.notifications}}),{previous:t}},onError:(e,t,n)=>{n?.previous&&(a.setQueryData(r.settings,n.previous),l(n.previous),g(n.previous.theme),m(n.previous.density)),p("Could not save settings. Restored previous state.")},onSuccess:e=>{a.setQueryData(r.settings,e),l(e),g(e.theme),m(e.density),p("Settings updated successfully.")},onSettled:()=>{a.invalidateQueries({queryKey:r.settings})}});if(o.isLoading||!i)return s.jsx(D,{message:"Loading preferences..."});if(o.isError)return s.jsx(L,{message:"Failed to load settings.",onRetry:()=>{o.refetch()}});const c=e=>{l(t=>t&&{...t,...e,notifications:{...t.notifications,...e.notifications}}),x.mutate(e)},f=()=>{if(!i)return;const e=i.locale.trim()||"en-US";l(t=>t&&{...t,locale:e}),c({locale:e})};return s.jsxs("section",{className:"grid gap-4 md:grid-cols-[2fr,1fr]",children:[s.jsxs("article",{className:"rounded-2xl border border-border/70 bg-surface/70 p-5 shadow-card",children:[s.jsx("h2",{className:"font-display text-xl font-semibold",children:"Workspace settings"}),s.jsx("p",{className:"mt-1 text-sm text-muted",children:"Adjust visual density, theme, and notifications."}),s.jsxs("div",{className:"mt-5 space-y-4",children:[s.jsxs("label",{className:"flex flex-col gap-2 text-sm",children:["Theme",s.jsxs("select",{"aria-label":"Theme",value:i.theme,onChange:e=>{const t=e.target.value;g(t),c({theme:t})},className:"rounded-lg border border-border bg-panel px-3 py-2",children:[s.jsx("option",{value:"sunrise",children:"Sunrise"}),s.jsx("option",{value:"midnight",children:"Midnight"})]})]}),s.jsxs("label",{className:"flex flex-col gap-2 text-sm",children:["Density",s.jsxs("select",{"aria-label":"Density",value:i.density,onChange:e=>{const t=e.target.value;m(t),c({density:t})},className:"rounded-lg border border-border bg-panel px-3 py-2",children:[s.jsx("option",{value:"comfortable",children:"Comfortable"}),s.jsx("option",{value:"compact",children:"Compact"})]})]}),s.jsxs("label",{className:"flex flex-col gap-2 text-sm",children:["Locale",s.jsx("input",{"aria-label":"Locale",type:"text",value:i.locale,onChange:e=>{const t=e.target.value;l(n=>n&&{...n,locale:t})},onBlur:f,onKeyDown:e=>{e.key==="Enter"&&f()},className:"rounded-lg border border-border bg-panel px-3 py-2"})]}),s.jsxs("fieldset",{className:"space-y-2 rounded-xl border border-border/70 bg-panel/60 p-4",children:[s.jsx("legend",{className:"px-1 text-sm font-semibold",children:"Notifications"}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{"aria-label":"Email alerts",type:"checkbox",checked:i.notifications.email,onChange:e=>c({notifications:{email:e.target.checked}})}),"Email alerts"]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{"aria-label":"Push alerts",type:"checkbox",checked:i.notifications.push,onChange:e=>c({notifications:{push:e.target.checked}})}),"Push alerts"]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{"aria-label":"Weekly digest",type:"checkbox",checked:i.notifications.weeklyDigest,onChange:e=>c({notifications:{weeklyDigest:e.target.checked}})}),"Weekly digest"]})]})]})]}),s.jsxs("aside",{className:"rounded-2xl border border-border/70 bg-surface/70 p-5 shadow-card",children:[s.jsx("h3",{className:"font-display text-lg font-semibold",children:"Sync status"}),s.jsx("p",{"aria-live":"polite",className:"mt-2 text-sm text-muted",children:x.isPending?"Saving changes...":v||"Changes are autosaved through optimistic updates."})]})]})};export{K as SettingsPage};
